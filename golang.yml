---

- hosts: all
  become: true

  tasks:
  - name: Macke directory
    file: 
      path: /golang_binary_file
      state: directory
      mode: 0777
      
  - name: Download golang binary file
    get_url: 
        url: https://golang.org/dl/go1.17.2.linux-amd64.tar.gz
        dest: /golang_binary_file/go.tar.gz

  - name: Delete golang directory if it exists
    ansible.builtin.file:
      path: /usr/local/go
      state: absent

  - name: Extract tar file in golang directory
    ansible.builtin.unarchive:
      src: /golang_binary_file/go.tar.gz
      dest: /usr/local

  - name: Set environment  
    ansible.builtin.lineinfile:
      path: /home/vagrant/.bashrc
      line: export PATH=$PATH:/usr/local/go/bin
      create: yes
  
  - shell: source /home/vagrant/.bashrc
    args:
      executable: /bin/bash
     

  - name: Check go ersion
    command: go version
    register: out
    environment:
      PATH: /usr/local/go/bin

  - debug:
      msg: "{{out.stdout}}"

  